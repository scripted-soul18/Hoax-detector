async function checkNews() {
  const newsText = document.getElementById("newsInput").value.trim();
  const resultDiv = document.getElementById("result");

  if (!newsText) {
    resultDiv.className = "error";
    resultDiv.textContent = "Please enter some news text to analyze.";
    return;
  }

  resultDiv.className = "analyzing";
  resultDiv.textContent = "Analyzing...";


  const API_KEY = "AIzaSyAgk64X6SA1ImgKAqBWberD_3AwwUFUEwA";

  const prompt = `
You are a fact-checking AI.

Analyze the following news text and classify it as:
- Real
- Fake
- Misleading

Provide:
1. Classification
2. Confidence (0-100)
3. Short explanation

News:
"""${newsText}"""
`;

  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [{ text: prompt }]
            }
          ]
        })
      }
    );

    if (!response.ok) {
      throw new Error(`API error: ${response.status} ${response.statusText}`);
    }

    const data = await response.json();
    console.log(data);
    
    // Extract the response text from Gemini API structure
    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
      const resultText = data.candidates[0].content.parts[0].text;
      
      // Format the response for better readability
      const formattedText = formatResponse(resultText);
      resultDiv.className = "";
      resultDiv.textContent = formattedText;
    } else {
      resultDiv.className = "error";
      resultDiv.textContent = "Error: Unexpected API response format";
    }
  } catch (error) {
    resultDiv.className = "error";
    resultDiv.textContent = "Error: " + error.message;
    console.error("Error details:", error);
  }
}

// Function to format the AI response with proper line breaks
function formatResponse(text) {
  // Replace numbered list items with line breaks
  let formatted = text
    // Add line break before numbered items (1., 2., 3., etc.)
    .replace(/(\d+\.\s)/g, '\n$1')
    // Add line break before "Classification:", "Confidence:", "Short explanation:"
    .replace(/(Classification|Confidence|Short explanation|Explanation):/gi, '\n$1:')
    // Add line break after colons followed by text
    .replace(/:\s*([A-Z])/g, ':\n$1')
    // Clean up multiple consecutive newlines
    .replace(/\n{3,}/g, '\n\n')
    // Trim leading/trailing whitespace
    .trim();
  
  // If the text doesn't have proper formatting, add line breaks after periods followed by numbers
  if (!formatted.includes('\n')) {
    formatted = text
      .replace(/(\d+\.\s)/g, '\n\n$1')
      .replace(/(Classification|Confidence|Explanation):/gi, '\n\n$1:')
      .trim();
  }
  
  return formatted;
}
